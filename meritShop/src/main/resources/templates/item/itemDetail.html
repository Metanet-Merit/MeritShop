<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/mainPageLayout}">

<div layout:fragment="content">

<!-- 사용자 스크립트 추가 -->
    <style>

       .contents{
            display: flex;
        }
        .mgb-15{
            margin-bottom:15px;
        }
        .mgt-30{
            margin-top:30px;
        }
        .mgt-50{
            margin-top:50px;
        }
        .repImgDiv{
            margin-right:15px;
            height:auto;
            width:50%;
        }
        .repImg{
            width:100%;
            height:500px;
        }
        .wd50{
            height:auto;
            width:50%;
        }
        .delivery_info{
            padding-top: 10px;
            padding-bottom: 13px;
        }
    </style>
    <link rel="stylesheet" href="/css/item.css" type="text/css">
<div id="wrap" class="container-fluid ">


    <div id="container" style="margin-left:0%;margin-right:10%">
        <div class="location"><a href="#">Home</a> &gt; <a href="#">대분류</a> &gt;<a href="#">소분류</a> &gt; <a href="#"><span class="txt_w">상품 관리</span></a></div>
        <div class="contents">
            <div class="repImgDiv">
                <img th:src="${itemImgDto[0].imgUrl}" class = "img-fluid rounded repImg" >
            </div>

            <div class="wd50">
                <form action="/pay" id="frm">
                    <input type="hidden" id="itemId" name="orderItemDtoList[0].itemId" th:value="${itemFormDto.itemId}">

                    <span th:if="${itemFormDto.status == T(com.merit.meritShop.item.domain.ItemSellStatus).SELL}" class="badge badge-primary mgb-15">
                    판매중
                </span>
                <span th:if="${itemFormDto.status == T(com.merit.meritShop.item.domain.ItemSellStatus).SOLD_OUT}" class="badge btn-danger mgb-15" >
                    품절
                </span>
                <div id="itemName" class="h4" th:text="${itemFormDto.name}"></div>
                <hr class="my-4">

                <div class="text-right">
                    <div class="h4 text-danger text-left">
                        <span id="itemPrice" th:text="${itemFormDto.price}">10000</span>원
                    </div>
                    <div class="delivery_info"><strong>배송비 3,000원</strong><span class="text_info">(50,000원 이상 무료)</span></div>
                    <div class="input-group w-50">
                        <div class="input-group-prepend">
                            <span class="input-group-text">수량</span>
                        </div>
                        <input type="number" name="orderItemDtoList[0].count" id="count" class="form-control" value="1" min="1">
                    </div>
                </div>
                <hr class="my-4">
                <div id="rate" class="rating" data-size="lg"  > 평점: 5.0 </div>
                <hr class="my-4">
                <div id="options">
                    option<br>
                    <select id="itmeOptionId" name="orderItemDtoList[0].itemOptionId" style="width:180px;">
                        <option>Select option</option>
                        <option th:each="option:${itemFormDto.options}"
                                    th:value="${option?.itemOptionId}"
                                    th:utext="${option?.optionName}"></option>
                    </select>
                </div>
                <hr class="my-4">
                <div class="text-right mgt-50">
                    <h5>결제 금액</h5>
                    <h3 name="totalPrice" id="totalPrice" class="font-weight-bold"></h3>
                </div>
                <div th:if="${itemFormDto.status == T(com.merit.meritShop.item.domain.ItemSellStatus).SELL}" class="text-right">
                    <button type="button" class="btn btn-light border border-primary btn-lg" onclick="">장바구니 담기</button>
                    <button type="button" class="btn btn-primary btn-lg"  id="order_btn">주문하기</button>
                </div>
                <div th:if="${itemFormDto.status == T(com.merit.meritShop.item.domain.ItemSellStatus).SOLD_OUT}" class="text-right">
                    <button type="button" class="btn btn-danger btn-lg">품절</button>
                </div>

                </form>
            </div>

        </div>
        <div class="tabList">
            <ul class="prd_detail_tab" id="tabList">
                <li class="on" id="productInfo">
                    <a href="#tab1" class="goods" data-tap="tab-1">상품설명
                    </a>
                </li>
                <li id="reviewInfo">
                    <a href="#tab2" class="goods" data-tap="tab-2">리뷰
                        <span>(843)</span>
                    </a>
                </li>
                <li id="qnaInfo">
                    <a href="#tab3" class="goods" data-tap="tab-3">Q&amp;A
                        <span>(19)</span>
                    </a>
                </li>
            </ul>
            <div class="prd_detail_cont" id="tabContent">
                <div>
                    <div class="jumbotron jumbotron-fluid mgt-30">
                        <div class="Description">
                            <h4 class="display-5">상품 상세 설명</h4>
                            <p class="lead" th:text="${itemFormDto.description}"></p>
                        </div>

                    </div>
                    <div th:each="itemImg : ${itemImgDto}" class="text-center">
                        <img th:if="${not #strings.isEmpty(itemImg.imgUrl)}" th:src="${itemImg.imgUrl}" class="rounded mgb-15" width="800">

                    </div>
                </div>
                <div style="display: none">

                </div>
                <div style="display: none">
                    <div class="prd_qna_tit">
                        <button class="btnInquiry goods_qna_inquiry" th:onclick="|location.href='@{/user/qnaWrite}'|">상품문의</button>
                    </div>
                    <ul class="prd_qna_list" id="prd_qna_list">
                        //보이는 화면
                        <li>
                            <div class="qna_tit_box">
                                <p class="qna_question">
                                    <span class="qna_flag"></span>
                                    <a href="javascript:;" class="completeBind" ></a>
                                </p>
                                <p class="tx_userid">
                                    <span ></span>

                                </p>
                                <p class="tx_date" ></p>
                            </div>
                            //title 클릭했을 때 보이는 내용들
                            <div class="qna_answer_box">
                                <div class="tx_question">
                                    <span class="ico_qna question" >Q</span>

                                </div>
                            </div>
                        </li>
                        //답변완료 보이는 화면
                        <li class="show">
                            <div class="qna_tit_box">
                                <p class="qna_question">
                                    <span class="qna_flag">답변여부 넣기</span>
                                    <a href="javascript:;" class="completeBind">qna title</a>
                                </p>
                                <p class="tx_userid">
                                    <span>user_name</span>

                                </p><p class="tx_date">registerDate</p>
                            </div>
                            //title 클릭했을 때 보이는 내용들
                            <div class="qna_answer_box">
                                <div class="tx_question">
                                    <span class="ico_qna question">Q</span>
                                    qna content
                                </div>
                                <div class="tx_answer">
                                    <span class="ico_qna answer">reply</span>
                                    qna reply
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
</div>
</div>
<script>
    window.onload = function() {
        document.getElementById('order_btn').onclick = function() {
            document.getElementById('frm').submit();
            return false;
        };
    };

    const getCookieValue = (key) => {
        let cookieKey = key + "=";
        let result = "";
        const cookieArr = document.cookie.split(";");

        for(let i = 0; i < cookieArr.length; i++) {
            if(cookieArr[i][0] === " ") {
                cookieArr[i] = cookieArr[i].substring(1);
            }

            if(cookieArr[i].indexOf(cookieKey) === 0) {
                result = cookieArr[i].slice(cookieKey.length, cookieArr[i].length);
                return result;
            }
        }
        return result;
    }
    function order(){
        var token = getCookieValue("Authorization");
        var url = "/order";
        var paramData = {
            itemId : $("#itemId").val(),
            itemOptionId : $("#itemOptionId").val(),
            count : $("#count").val()

        };
        console.log(paramData)
        var param = JSON.stringify(paramData);

        $.ajax({
            url      : url,
            type     : "POST",
            contentType : "application/json",
            data     : param,
            dataType : "json",
            cache   : false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", token);
            },
            success  : function(result, status){

                console.log(result);
                location.href='/pay/'+result;
            },
            error : function(jqXHR, status, error){

                if(jqXHR.status == '401'){
                    alert('로그인 후 이용해주세요');
                    location.href='/user/login';
                } else{
                    //alert(jqXHR.responseText);
                    console.log("현재는 이것만 뜬다네 ㅎㅎ");
                }

            }
        });
    }

</script>
<script>
    const tabMenu = document.querySelectorAll('#tabList>li');

    const tabContent = document.querySelectorAll('#tabContent>div');

    tabMenu.forEach(function (item, idx) {
        item.addEventListener('click', function (e) {
            e.preventDefault();
            showContent(idx);
            for(var i=0; i<3; i++) {
                tabMenu[i].classList.remove("on");
            }
            tabMenu[idx].classList.add("on");
        });

    });
    function showContent(num) {
        tabContent.forEach(function (item) {
            item.style.display = 'none';

        });
        tabContent[num].style = 'block';

    };


</script>

</div>